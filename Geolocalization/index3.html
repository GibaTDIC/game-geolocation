<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Área do Professor - Criar Prova</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    * { font-family: "Share Tech Mono", monospace; }
    body { 
      margin: 0;
      padding: 20px;
      background-color: #f9f9f9;
      background-image: url(assets/img/prof3.png);
      background-size: cover;       
      background-position: center;        
      background-repeat: no-repeat;
    }

.menu {
  position: fixed;          /* fixa no topo */
  top: 0;
  left: 0;
  right: 0;
  width: 100%;              /* ocupa toda a largura */
  display: flex;
  justify-content: center;
  gap: 15px;
  background: rgba(0, 0, 20, 0.85); /* fundo escuro translúcido */
  padding: 8px;
  border-bottom: 2px solid #444;    /* apenas uma linha discreta embaixo */
  z-index: 1000;            /* garante que fique acima do conteúdo */
}



.menu .btn {
  padding: 6px 18px;        /* mais fino */
  background: rgba(0, 0, 30, 0.95);
  color: #00f0ff;
  text-decoration: none;
  border-radius: 6px;
  font-family: "Share Tech Mono", monospace;
  font-size: 16px;
  text-transform: uppercase;
  border: 1px solid #00f0ff;
  box-shadow: 0 0 8px #00f0ff, inset 0 0 4px #003344;
  transition: all 0.3s ease;
}

.menu .btn:hover {
  background: #001a1a;
  transform: scale(1.05);
  text-shadow: 0 0 6px #00f0ff;
  box-shadow: 0 0 15px #00f0ff, inset 0 0 6px #00f0ff;
}

    h2 {
  text-align: center;
  font-family: "Orbitron", "Share Tech Mono", monospace; /* fonte digital futurista */
  font-size: 28px;
  color: #00f0ff; /* azul neon */
  text-transform: uppercase;
  letter-spacing: 2px; /* espaçamento entre letras para efeito digital */
  text-shadow: 0 0 5px #000, 0 0 10px #00f0ff; /* brilho neon */
  margin-bottom: 20px;
  margin-top: 40px;
  
}

    .pergunta {
      margin-bottom: 20px;
    }
    textarea, imput {
      width: 95%;
      padding: 10px;
      resize: vertical;
      background-color: rgba(0, 0, 30, 0.8); /* fundo escuro translúcido */
      border: 2px solid #00f0ff; /* borda neon azul */
      box-shadow: 0 0 10px #00f0ff, inset 0 0 5px #00f0ff; /* brilho externo e interno */
      color: #ffffff;
      font-size: 16px;
      border-radius: 8px;
    }

    .opcao {
  display: flex;
  align-items: center;
  margin-top: 10px;
  gap: 10px; /* espaço entre input e círculo */
}

.opcao input {
  flex: 1;
  padding: 10px;
  background-color: rgba(0, 0, 20, 0.95); /* fundo escuro quase opaco */
  border: 2px solid #00f0ff;              /* borda neon azul */
  box-shadow: 0 0 10px #00f0ff, inset 0 0 5px #00f0ff; /* brilho externo e interno */
  color: #ffffff;
  font-size: 16px;
  border-radius: 8px;
  transition: all 0.3s ease;
}

/* Efeito ao focar no campo */
.opcao input:focus {
  outline: none;
  background-color: rgba(0, 0, 30, 1); /* ainda mais escuro */
  box-shadow: 0 0 20px #00f0ff, inset 0 0 10px #00f0ff;
}

    .circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-left: 10px;
      cursor: pointer;
      border: 2px solid #00f0ff;
      box-shadow: 0 0 8px #00f0ff;
    }
    .a { background: #ff595e; } .b { background: #ffca3a; }
    .c { background: #8ac926; } .d { background: #1982c4; }
    .selected { border: 6px solid #000; }

  .linha-coordenadas {
  display: flex;
  gap: 30px;              /* espaço entre código e lat/long */
  margin-bottom: 20px;
  align-items: flex-start; /* alinha pelo topo */
  justify-content: center; /* centraliza o conjunto na linha */
}

.codigo-container {
  flex: 2;
  display: flex;
  justify-content: center; /* centraliza o input */
}

.codigo-container input {
  width: 450px;            /* largura maior */
  height: 60px;
  padding: 20px;
  background-color: rgba(0, 0, 20, 0.95);
  border: 2px solid #00f0ff;
  box-shadow: 0 0 15px #00f0ff, inset 0 0 6px #00f0ff;
  color: #ffffff;
  font-size: 30px;
  border-radius: 8px;
  font-family: "Share Tech Mono", monospace;
  text-align: center;
  font-size: 2.5rem;   /* aumenta conforme a tela */
  width: 80%;          /* ocupa 80% da largura disponível */

}

.latlong {
  display: flex;
  flex-direction: column; /* coloca um em cima do outro */
  gap: 10px;
  flex: 1;
}

.latlong input {
  width: 150px;
  padding: 8px;
  background-color: rgba(0, 0, 20, 0.95);
  border: 2px solid #00f0ff;
  box-shadow: 0 0 8px #00f0ff, inset 0 0 4px #00f0ff;
  color: #ffffff;
  font-size: 14px;
  border-radius: 6px;
  text-align: center;
  font-family: "Share Tech Mono", monospace;
}



  .nav-buttons {
  display: flex;
  justify-content: space-between; /* separa os grupos */
  align-items: center;
  margin-top: 20px;
}

/* Grupo de navegação (Voltar, +, Avançar) */
.nav-group {
  display: flex;
  gap: 10px;
  align-items: center;
}

/* Botão Finalizar Prova */
.finalizar-btn {
  padding: 12px 24px;
  background: rgba(0,0,30,0.8);
  border: 2px solid #00f0ff;
  color: #00f0ff;
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  text-transform: uppercase;
  box-shadow: 0 0 12px #00f0ff, inset 0 0 6px #00f0ff;
  transition: all 0.3s ease;
}

.finalizar-btn:hover {
  background: #00f0ff;
  color: #000;
  box-shadow: 0 0 20px #00f0ff;
}

button {
  padding: 12px 24px;
  background: rgba(0,0,30,0.8); /* fundo escuro translúcido */
  border: 2px solid #00f0ff;    /* borda neon azul */
  color: #00f0ff;
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  text-transform: uppercase;
  box-shadow: 0 0 12px #00f0ff, inset 0 0 6px #00f0ff; /* brilho externo e interno */
  transition: all 0.3s ease;
}

button:hover {
  background: #00f0ff;
  color: #000;
  box-shadow: 0 0 20px #00f0ff;
}

/* Botão de adicionar (+) com estilo circular neon */
.plus-btn {
  font-size: 24px;
  width: 40px;
  height: 40px;
  padding: 0;
  border-radius: 50%;      /* deixa circular */
  display: flex;           /* permite centralizar o símbolo + */
  justify-content: center;
  align-items: center;
  margin: 0;               /* remove o margin auto que isolava */
}

.plus-btn:hover {
  background: #00f0ff;
  color: #000;
  box-shadow: 0 0 20px #00f0ff;
}

    .codigo-container { text-align: center; margin-bottom: 20px; }
    .codigo-container input { 
      padding: 10px; 
      width: 150px; 
      text-align: center; 
      font-size: 18px; 
      background-color: rgba(0, 0, 30, 0.6);
      border: 2px solid #00f0ff;
      box-shadow: 0 0 10px #00f0ff;
      color: #00f0ff;
      font-weight: bold;
    }
  </style>
</head>
<body>
<nav class="menu">
  <a href="index.html" class="btn">Início</a>
  <a href="areap.html" class="btn">Área do professor</a>
  </nav>

<h2>CRIAR DESAFIOS</h2>

<div class="linha-coordenadas">
    <div class="latlong">
    <input type="text" id="latitude" placeholder="Latitude da CHAVE FINAL" />
    <input type="text" id="longitude" placeholder="Longitude da CHAVE FINAL" />
  </div>
  <div class="codigo-container">
    <input type="text" id="codigoPergunta" placeholder="Código da Pergunta" readonly />
  </div>
</div>



<div class="pergunta">
  <textarea id="enunciado" rows="4" placeholder="Digite o enunciado da pergunta..."></textarea>

  <div class="opcao">
    <input type="text" placeholder="Alternativa A" />
    <div class="circle a" data-index="0"></div>
  </div>

  <div class="opcao">
    <input type="text" placeholder="Alternativa B" />
    <div class="circle b" data-index="1"></div>
  </div>

  <div class="opcao">
    <input type="text" placeholder="Alternativa C" />
    <div class="circle c" data-index="2"></div>
  </div>

  <div class="opcao">
    <input type="text" placeholder="Alternativa D" />
    <div class="circle d" data-index="3"></div>
  </div>
</div>

<div class="nav-buttons">
  <div class="nav-group">
    <button id="btn-voltar">Voltar</button>
    <button class="plus-btn">+</button>
    <button id="btn-avancar">Avançar</button>
  </div>
  <button id="btnFinalizar">Finalizar Prova</button>
</div>




<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC3P2fwNlkUPkpoCnaxWtp9-61163huINE",
  authDomain: "game-geolocation.firebaseapp.com",
  databaseURL: "https://game-geolocation-default-rtdb.firebaseio.com",
  projectId: "game-geolocation",
  storageBucket: "game-geolocation.firebasestorage.app",
  messagingSenderId: "488902360575",
  appId: "1:488902360575:web:3419d3432b453d76767bca"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Pergunta inicial
let perguntas = [{
  enunciado: "",
  opcoes: ["", "", "", ""],
  latitude: "",
  longitude: "",
  codigo: gerarCodigo(),
  respostaCorreta: null
}];

let perguntaAtual = 0;

function gerarCodigo() {
  return Math.floor(100000 + Math.random() * 900000).toString();
}

function renderizar() {
  const p = perguntas[perguntaAtual];

  document.getElementById("enunciado").value = p.enunciado;
  document.querySelectorAll(".opcao input").forEach((input, i) => {
    input.value = p.opcoes[i];
  });

  document.getElementById("latitude").value = p.latitude;
  document.getElementById("longitude").value = p.longitude;
  document.getElementById("codigoPergunta").value = p.codigo;

  document.querySelectorAll(".circle").forEach((circle, i) => {
    circle.classList.toggle("selected", p.respostaCorreta === i);
  });
}

function salvarEdicoes() {
  const p = perguntas[perguntaAtual];

  p.enunciado = document.getElementById("enunciado").value;
  p.opcoes = Array.from(document.querySelectorAll(".opcao input")).map(i => i.value);
  p.latitude = document.getElementById("latitude").value;
  p.longitude = document.getElementById("longitude").value;
}

document.querySelectorAll(".circle").forEach(circle => {
  circle.onclick = () => {
    perguntas[perguntaAtual].respostaCorreta = parseInt(circle.dataset.index);

    document.querySelectorAll(".circle").forEach((c, i) => {
      c.classList.toggle("selected", perguntas[perguntaAtual].respostaCorreta === i);
    });
  };
});

document.querySelector(".plus-btn").onclick = () => {
  salvarEdicoes();

  perguntas.push({
    enunciado: "",
    opcoes: ["", "", "", ""],
    latitude: "",
    longitude: "",
    codigo: gerarCodigo(),
    respostaCorreta: null
  });

  perguntaAtual = perguntas.length - 1;
  renderizar();
};

document.getElementById("btn-avancar").onclick = () => {
  if (perguntaAtual < perguntas.length - 1) {
    salvarEdicoes();
    perguntaAtual++;
    renderizar();
  }
};

document.getElementById("btn-voltar").onclick = () => {
  if (perguntaAtual > 0) {
    salvarEdicoes();
    perguntaAtual--;
    renderizar();
  }
};

document.getElementById("btnFinalizar").onclick = async () => {
  salvarEdicoes();

  const titulo = prompt("Título da prova:");
  const professor = prompt("Nome do professor:");
  const latitudeChave = document.getElementById("latitude").value;
  const longitudeChave = document.getElementById("longitude").value;

  abrirUpload(async urlDaImagem => {
    const codigoProva = gerarCodigo();

    await set(ref(db, "provas/" + codigoProva), {
  titulo,
  professor,
  latitudeChave,
  longitudeChave,
  codigoProva,
  imagemProvaURL: urlDaImagem, // único mapa da prova
  perguntas,
  dataCriacao: new Date().toISOString()
});


    alert("Prova criada! Código: " + codigoProva);
  });
};

// Modal Cloudinary
function abrirUpload(onFinish) {
  const modal = document.createElement("div");
  modal.innerHTML = `
    <div style="position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;">
      <div style="background:white;padding:25px;border-radius:10px;">
        <h3>Enviar imagem do mapa</h3>
        <input type="file" id="arq" accept="image/*">
        <button id="env">Enviar</button>
      </div>
    </div>
  `;

modal.querySelector("#env").onclick = async () => {
  const f = modal.querySelector("#arq").files[0];
  if (!f) return alert("Selecione uma imagem!");

  const fd = new FormData();
  fd.append("file", f);
  fd.append("upload_preset", "geomapas");

  try {
    const r = await fetch("https://api.cloudinary.com/v1_1/dqikxjhp3/image/upload", {
      method: "POST",
      body: fd
    });
    const j = await r.json();

    console.log("Resposta do Cloudinary:", j);

    if (!j.secure_url) {
      alert("Erro ao enviar imagem. Verifique o preset no Cloudinary.");
      return;
    }

    // remove o modal com segurança
    if (document.body.contains(modal)) {
      document.body.removeChild(modal);
    }

    onFinish(j.secure_url);

  } catch (err) {
    console.error("Erro de rede:", err);
    alert("Erro ao enviar imagem. Veja o console para detalhes.");
  }
};

  document.body.appendChild(modal);
}

renderizar();
</script>

</body>
</html>
