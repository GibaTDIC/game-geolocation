<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerar QR Codes</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <!-- Importa a imagem da pasta -->
  <link rel="stylesheet" href="css/jogo.css">
<!-- Fonte para ícones -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Biblioteca jsPDF para gerar arquivos PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Biblioteca QRCode.js para gerar códigos QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <style>
    body {
  padding-top: 0px;
  background-image: url('assets/img/qrcode.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  background-attachment: fixed;
  display: flex;
  flex-direction: column;   /* organiza em coluna */
  align-items: center;      /* centraliza horizontal */
  min-height: 100vh;
  font-family: "Orbitron", "Share Tech Mono", monospace; /* fonte digital futurista */
  overflow-x: hidden;
  margin: 0;
  height: 100%;
    }
 .menu {
  position: fixed;          /* fixa no topo */
  top: 0;
  left: 0;
  right: 0;
  width: 100%;              /* ocupa toda a largura */
  display: flex;
  justify-content: center;
  gap: 15px;
  background: rgba(0, 0, 20, 0.85); /* fundo escuro translúcido */
  padding: 8px;
  border-bottom: 2px solid #444;    /* apenas uma linha discreta embaixo */
  z-index: 1000;            /* garante que fique acima do conteúdo */
}

.menu .btn {
  padding: 6px 18px;        /* mais fino */
  background: rgba(0, 0, 30, 0.95);
  color: #00f0ff;
  text-decoration: none;
  border-radius: 6px;
  font-family: "Share Tech Mono", monospace;
  font-size: 16px;
  text-transform: uppercase;
  border: 1px solid #00f0ff;
  box-shadow: 0 0 8px #00f0ff, inset 0 0 4px #003344;
  transition: all 0.3s ease;
}

.menu .btn:hover {
  background: #001a1a;
  transform: scale(1.05);
  text-shadow: 0 0 6px #00f0ff;
  box-shadow: 0 0 15px #00f0ff, inset 0 0 6px #00f0ff;
}
    h1 {
  font-family: "Orbitron", "Share Tech Mono", monospace; /* fonte digital futurista */
  font-size: 28px;
  color: #00f0ff; /* azul neon */
  text-transform: uppercase;
  letter-spacing: 2px; /* espaçamento entre letras para efeito digital */
  text-shadow: 0 0 5px #000, 0 0 10px #00f0ff; /* brilho neon */
  margin-bottom: 20px;
  margin-top: 60px;
  background-color: rgba(0, 0, 0, 0.6); /* fundo escuro semi-transparente */
  padding: 20px 40px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      text-align: center;
      font-family: "Orbitron", monospace; /* fonte futurista */
    }

    input {
  padding: 20px;
  font-size: 30px;
  border: 2px solid #00f0ff; /* azul neon */
  border-radius: 8px;
  width: 100%;
  text-align: center;
  background-color: #0a0a0a; /* fundo escuro */
  color: #00f0ff; /* texto neon */
  box-shadow: 0 0 10px #00f0ff, 0 0 20px #560084; /* efeito glow */
  transition: all 0.3s ease-in-out;
  font-family: "Orbitron", monospace;
    }
    input:focus {
  outline: none;
  border-color: #ff00ff;
  box-shadow: 0 0 15px #ff00ff, 0 0 30px #00f0ff;
    }

    button {
      padding: 12px 24px;
     cursor: pointer;
     margin-top: 40px;
     background: rgba(0, 0, 30, 0.95);
     color: #00f0ff;
     text-decoration: none;
     border-radius: 6px;
     font-family: "Share Tech Mono", monospace;
     font-size: 16px;
     text-transform: uppercase;
     border: 1px solid #00f0ff;
     box-shadow: 0 0 8px #00f0ff, inset 0 0 4px #003344;
     transition: all 0.3s ease;
    }
    button:hover {
         background: #00f0ff;
         color: #000;
         box-shadow: 0 0 20px #00f0ff;
    }
  </style>
</head>
<body>
<!-- Menu superior -->
  <nav class="menu">
  <a href="index.html" class="btn">Início</a>
  <a href="areap.html" class="btn"><i class="fa-solid fa-robot" style="margin-right:8px;"></i>Área do professor</a>
  </nav>
  <!-- Título principal da página -->
  <h1>Gerar QR Codes da Prova</h1>

  <!-- Container com input e botão -->
  <div class="container">
    <!-- Campo para digitar o código da prova -->
    <input type="text" id="prova-id" placeholder="Digite o código da prova" />
    <!-- Botão que chama a função gerarPDF() -->
    <button onclick="gerarPDF()">Gerar PDF com QRCode</button>
  </div>

  <script type="module">
    // Importa funções do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    // Configuração do Firebase do seu projeto
    const firebaseConfig = {
  apiKey: "AIzaSyC3P2fwNlkUPkpoCnaxWtp9-61163huINE",
  authDomain: "game-geolocation.firebaseapp.com",
  databaseURL: "https://game-geolocation-default-rtdb.firebaseio.com",
  projectId: "game-geolocation",
  storageBucket: "game-geolocation.firebasestorage.app",
  messagingSenderId: "488902360575",
  appId: "1:488902360575:web:3419d3432b453d76767bca"
};

    // Inicializa o Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Função global chamada ao clicar no botão
    window.gerarPDF = async () => {
      const { jsPDF } = window.jspdf; // Acesso ao construtor jsPDF
      const doc = new jsPDF(); // Cria novo documento PDF

      // Pega o valor digitado no campo
      const provaId = document.getElementById("prova-id").value.trim();
      if (!provaId) {
        alert("Por favor, insira o código da prova.");
        return;
      }

      try {
        // Acessa o caminho 'provas/{provaId}' no Firebase
        const snapshot = await get(child(ref(db), `provas/${provaId}`));

        // Verifica se a prova existe
        if (!snapshot.exists()) {
          alert("Prova não encontrada.");
          return;
        }

        // Obtém o array de perguntas (esperado que cada uma tenha um 'codigo')
        const perguntas = snapshot.val().perguntas || [];

        // Laço para gerar QR Code de cada pergunta
        for (let i = 0; i < perguntas.length; i++) {
          const codigo = perguntas[i].codigo;
          if (!codigo) continue; // Pula se não houver código

          // Cria um elemento canvas para desenhar o QR Code
          const qrCanvas = document.createElement("canvas");

          // Gera o QR Code no canvas com largura de 300px
          await QRCode.toCanvas(qrCanvas, codigo, { width: 300 });

          // Converte o canvas em imagem (data URL)
          const qrDataUrl = qrCanvas.toDataURL("image/png");

          // Se não for a primeira página, adiciona nova página ao PDF
          if (i > 0) doc.addPage();

          // Adiciona a imagem do QR ao PDF (posição x=20, y=20, largura=170, altura=170)
          doc.addImage(qrDataUrl, "PNG", 20, 20, 90, 90);
        }

        // Salva o arquivo PDF com nome baseado no ID da prova
        doc.save(`qrcodes_${provaId}.pdf`);

      } catch (err) {
        // Em caso de erro na leitura do banco ou geração do PDF
        console.error(err);
        alert("Erro ao gerar QR Codes.");
      }
    };
  </script>

</body>
</html>
